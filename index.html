<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poetry Eternal</title>
    <meta name="description" content="Poetry by Yusuf Misdaq - A collection of contemporary poetry exploring themes of love, prayer, society, and the human experience.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Georgia, 'Times New Roman', serif;
            background: white;
            color: #000;
            line-height: 1.6;
        }

        header {
            border-bottom: 1px solid #000;
            padding: 3rem 2rem;
            text-align: center;
            background: #000;
            color: #fff;
        }

        .site-title {
            font-size: 3rem;
            letter-spacing: 0.5em;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: opacity 0.3s;
            color: #fff;
        }

        .site-title:hover {
            opacity: 0.7;
        }

        .site-subtitle {
            font-size: 1.5rem;
            letter-spacing: 0.3em;
            margin-bottom: 2rem;
            color: #fff;
        }

        .categories {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .category-link {
            cursor: pointer;
            transition: all 0.3s;
            color: #fff;
        }

        .category-link:hover {
            text-decoration: underline;
        }

        .category-link.active {
            font-weight: bold;
            text-decoration: underline;
        }

        main {
            max-width: 50rem;
            margin: 0 auto;
            padding: 4rem 2rem;
            min-height: 60vh;
        }

        .poem-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .poem-author {
            font-size: 0.9rem;
            margin-bottom: 2rem;
        }

        .poem-author a {
            color: #000;
            text-decoration: underline;
        }

        .poem-content {
            font-size: 1.1rem;
            line-height: 1.8;
            white-space: pre-wrap;
            margin-bottom: 2rem;
        }

        .poem-location, .poem-note {
            font-size: 0.9rem;
            font-style: italic;
            margin-bottom: 0.5rem;
        }

        .new-poem-button {
            display: block;
            margin: 2rem 0 0 auto;
            padding: 0.75rem 2rem;
            background: #DAA520;
            color: #000;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-family: Georgia, serif;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .new-poem-button:hover {
            background: #C49A1A;
        }

        .interactive-sections {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid #ddd;
        }

        .dropdown-section {
            border-bottom: 1px solid #f0f0f0;
            padding: 1rem 0;
        }

        .dropdown-trigger {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-family: Georgia, serif;
        }

        .dropdown-trigger:hover {
            opacity: 0.7;
        }

        .dropdown-content {
            margin-top: 1rem;
            padding-left: 1.75rem;
        }

        .dropdown-content a, .dropdown-content button {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
            color: #000;
            background: none;
            border: none;
            cursor: pointer;
            text-align: left;
            padding: 0;
            text-decoration: none;
            font-family: Georgia, serif;
        }

        .dropdown-content a:hover, .dropdown-content button:hover {
            text-decoration: underline;
        }

        .book-display {
            display: flex;
            gap: 1.5rem;
        }

        .book-cover {
            width: 8rem;
            height: 12rem;
            object-fit: cover;
            border: 1px solid #ddd;
        }

        .amazon-link {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: #000;
            color: #fff;
            text-decoration: none;
            font-size: 0.85rem;
        }

        footer {
            border-top: 1px solid #000;
            background: #000;
            color: #fff;
            padding: 2rem;
            text-align: center;
            margin-top: 4rem;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .footer-links a, .footer-links button {
            color: #fff;
            text-decoration: none;
            background: none;
            border: none;
            cursor: pointer;
            font-family: Georgia, serif;
        }

        .footer-links a:hover, .footer-links button:hover {
            text-decoration: underline;
        }

        .admin-container {
            max-width: 60rem;
            margin: 0 auto;
            padding: 2rem;
            background: #f9f9f9;
            min-height: 100vh;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .admin-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: Georgia, serif;
        }

        .form-group textarea {
            min-height: 20rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }

        .book-fields {
            margin-top: 1rem;
            padding-left: 1.5rem;
            border-left: 2px solid #ddd;
        }

        .book-fields input {
            width: 100%;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 0.5rem;
            font-family: Georgia, serif;
        }

        .button-primary {
            background: #000;
            color: #fff;
        }

        .button-primary:hover {
            background: #333;
        }

        .button-secondary {
            background: #fff;
            color: #000;
            border: 1px solid #ddd;
        }

        .button-warning {
            background: #fbbf24;
            color: #000;
        }

        .button-danger {
            background: #ef4444;
            color: #fff;
        }

        .poem-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .poem-list-item:hover {
            background: #f9f9f9;
        }

        .category-chip {
            display: inline-block;
            background: #f0f0f0;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            border-radius: 4px;
        }

        .category-chip button {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            margin-left: 0.5rem;
        }

        .hidden {
            display: none;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-box {
            width: 100%;
            max-width: 28rem;
            padding: 2rem;
        }

        @media (max-width: 768px) {
            .site-title {
                font-size: 2rem;
                letter-spacing: 0.3em;
            }
            .site-subtitle {
                font-size: 1.2rem;
            }
            .checkbox-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .book-display {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="public-view">
        <header>
            <h1 class="site-title" onclick="goHome()">P O E T R Y</h1>
            <h2 class="site-subtitle">E T E R N A L</h2>
            <div class="categories" id="categories-container"></div>
        </header>
        <main id="poem-display"></main>
        <footer>
            <div class="footer-links">
                <button onclick="goToAdmin()">Admin</button>
                <a href="#contact">Contact</a>
                <a href="#donate">Donate</a>
            </div>
            <p style="font-size: 0.75rem; opacity: 0.7;">Â© <span id="year"></span> Poetry Eternal. All rights reserved.</p>
        </footer>
    </div>

    <div id="login-view" class="hidden">
        <div class="login-container">
            <div class="login-box">
                <h1 style="text-align: center; margin-bottom: 2rem;">Admin Login</h1>
                <input type="password" id="password-input" placeholder="Password" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 1rem;">
                <button onclick="login()" class="button button-primary" style="width: 100%;">Login</button>
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="#" onclick="goHome(); return false;" style="font-size: 0.9rem; text-decoration: underline;">Back to site</a>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-view" class="hidden">
        <div class="admin-container">
            <div class="admin-header">
                <h1>Admin Panel</h1>
                <button onclick="logout()" style="text-decoration: underline; background: none; border: none; cursor: pointer;">Logout</button>
            </div>

            <div class="admin-section">
                <h2 id="form-title">Add New Poem</h2>
                <div class="form-group">
                    <label>Author Name</label>
                    <input type="text" id="author-input" value="Yusuf Misdaq">
                </div>
                <div class="form-group">
                    <label>Poem Title</label>
                    <input type="text" id="title-input">
                </div>
                <div class="form-group">
                    <label>Poem Content (paste exactly as you want it to appear)</label>
                    <textarea id="content-input"></textarea>
                </div>
                <div class="form-group">
                    <label>Location & Date (e.g., "San Diego, September, 2009")</label>
                    <input type="text" id="location-input">
                </div>
                <div class="form-group">
                    <label>Note/Reference (optional)</label>
                    <input type="text" id="note-input">
                </div>
                <div class="form-group">
                    <label>Select Categories</label>
                    <div class="checkbox-grid" id="category-checkboxes"></div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="book-toggle" style="width: auto; margin-right: 0.5rem;">
                        This poem is from a published book
                    </label>
                    <div id="book-fields" class="book-fields hidden">
                        <input type="text" id="book-title" placeholder="Book Title">
                        <input type="text" id="book-amazon" placeholder="Amazon URL">
                        <input type="text" id="book-cover" placeholder="Cover Image URL (use Imgur or similar)">
                        <input type="text" id="book-year" placeholder="Year">
                    </div>
                </div>
                <button onclick="savePoem()" class="button button-primary">Save Poem</button>
                <button onclick="cancelEdit()" class="button button-secondary hidden" id="cancel-btn">Cancel</button>
            </div>

            <div class="admin-section">
                <h2>Manage Categories</h2>
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <input type="text" id="new-category" placeholder="New category name" style="flex: 1; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <button onclick="addCategory()" class="button button-primary">Add Category</button>
                </div>
                <div id="category-chips"></div>
            </div>

            <div class="admin-section">
                <h2>All Poems (<span id="poem-count">0</span>)</h2>
                <div id="poems-list"></div>
            </div>

            <div class="admin-section">
                <h2>Manage Comments</h2>
                <p style="margin-bottom: 1rem; color: #666;">View and moderate all comments across your poems.</p>
                <div id="comments-list"></div>
            </div>

            <div class="admin-section">
                <h2>Backup & Restore</h2>
                <p style="margin-bottom: 1rem; color: #666;">Export your poems to save a backup, or import previously saved data.</p>
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <button onclick="exportData()" class="button button-primary">ðŸ“¥ Export All Data</button>
                    <button onclick="document.getElementById('import-file').click()" class="button button-secondary">ðŸ“¤ Import Data</button>
                </div>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
                <p style="font-size: 0.85rem; color: #999;">Export creates a JSON file with all your poems and categories. Keep it safe as a backup!</p>
            </div>

            <div class="admin-section">
                <h2>ðŸš€ Sync to GitHub</h2>
                <p style="margin-bottom: 1rem; color: #666;">Click below to get the updated data code. Copy it and paste it into your index.html file on GitHub.</p>
                <button onclick="showGitHubSync()" class="button button-primary" style="background: #2ea44f;">ðŸ“¤ Generate Sync Code</button>
                <div id="github-sync-output" class="hidden" style="margin-top: 1.5rem;">
                    <p style="font-weight: 500; margin-bottom: 0.5rem;">Instructions:</p>
                    <ol style="margin-bottom: 1rem; padding-left: 1.5rem; line-height: 1.8;">
                        <li>Copy the code below (click the "Copy" button)</li>
                        <li>Go to your GitHub repo: <a href="https://github.com/yusuf-misdaq/eternal-poetry" target="_blank" style="text-decoration: underline;">eternal-poetry</a></li>
                        <li>Click on <code style="background: #f0f0f0; padding: 0.2rem 0.4rem;">index.html</code> â†’ pencil icon (Edit)</li>
                        <li>Find the line that says <code style="background: #f0f0f0; padding: 0.2rem 0.4rem;">var data = {</code> (around line 422)</li>
                        <li>Select everything from <code style="background: #f0f0f0; padding: 0.2rem 0.4rem;">var data = {</code> down to the closing <code style="background: #f0f0f0; padding: 0.2rem 0.4rem;">};</code></li>
                        <li>Delete that section and paste your new code</li>
                        <li>Scroll down â†’ "Commit changes"</li>
                        <li>Wait 2-3 minutes for GitHub Pages to update</li>
                    </ol>
                    <button onclick="copyGitHubCode()" class="button button-secondary" style="margin-bottom: 0.5rem;">ðŸ“‹ Copy Code</button>
                    <div id="github-code-display" style="background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; padding: 1rem; max-height: 20rem; overflow-y: auto; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; word-break: break-all;"></div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <a href="#" onclick="goHome(); return false;" style="text-decoration: underline;">View Site</a>
            </div>
        </div>
    </div>

    <script>
        var data = {
  "poems": [
    {
      "id": 1,
      "title": "On the Doorstep of your Studio, while you Sleep Within",
      "author": "Yusuf Misdaq",
      "content": "\"Wa laylee itha sajaa\" *\n\nI sit between a long-legged\nThin spider that rests in the corner of a\nMidnight plant.\nAnd to my right, a small slug.\nI am snug in between them both\nThe night is theirs\nI am the visitor.\n\nI have come on Earth to taste sweetness\nTo watch spiders\nSee fences errected\nClosed flowers under the black mixture of\nMoon and fog.\n\nFaraway light that leaves\nAnd the distant sound, also faraway\nOf neighbourhood sirens and conflict\nSmall and dry sound\nLike the spider\nIt is never far\nOur father of death.\n\nFor these years of life\nThe truthful clouds\nPluming and roseing\nBlooming and passing\nHave watched me as I watched them\nThey have seen how",
      "location": "September, 2009. South Park, San Diego.",
      "note": "* Quran 93:2",
      "categories": [
        "moving",
        "prayer"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759819915467,
      "title": "Echoing of Chasmic Vervours",
      "author": "Yusuf Misdaq",
      "content": "Firey hands touch the material and\nEverything burns up to\nImmediate flame \n\nThe game is gone and\nThe hand is played\n\nWhen the point of breathing at nothing comes \nYour chasmic vervour \nShimmers as a black patch upon a \nLava crawl \n\nEverything will melt unto \nPure nothing \n\nThe body a sumptuously devoured flake bidden bye\n\nA mind that made a million molehills is now one with the mountain\n\nA fountain of Divine lava \nThe final sentence of Gods love in this life\nThe crumbling meandering overwashing that must happen\nTo all forms\nBefore gas and spirit \nbegin to form\nAnew \n\nThe Godliness of us \nMarks us\n\nWe canÃ¢â‚¬â„¢t go quietly \nWe are so Divine we \nWill never shut down\n\nLike some silly line \nA child drew \nWe keep on flowing \nFrom river to sea \n     and\nFrom sea we \nAre siphoned off into \nEternity",
      "location": "September 30th, 2025. Historic Filipinotown, Los Angeles",
      "note": "",
      "categories": [
        "moving",
        "prayer",
        "water"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759820195759,
      "title": "az gul amadee",
      "author": "Yusuf Misdaq",
      "content": "Prime coming. \nA sure force\nAligning such that\nTwo rhythms and\n     Timelines begin merging.\n\n~\n\nChannels untucked.\n   Rapidly dissipating residuals\n  That which remains of the statue \n  Is what love refused to\n        Cast away.   \n\n~\n\nSixteen places out\nUncategorized peripheries\n\nIn dreams we met there\nAnd in life we are\n   Trying to square the clouds\n   Into something\n   The sun can shine on.",
      "location": "September 11th, 2022. Washington D.C.",
      "note": "",
      "categories": [
        "afg",
        "love"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759820273485,
      "title": "Plane to Medina",
      "author": "Yusuf Misdaq",
      "content": "Bigger than generational wealth \n\nA calling into the future\nDown the everlong tunnel of my descendants\nHere we were, IÃ¢â‚¬â„¢ll say\nOn each others shoulders\nGifting you the latest transmissions \n\nWe heard and obeyed\nPassed on what we could\nMay He have mercy on us\nWhat limitations we were bound by!\nLove and loneliness and living in a time of \nDis ease and desperation\n\nAside from our darling period, before we came of age, \nIt has all been a storm. \nWeÃ¢â‚¬â„¢ve weathered it as best we could \nFor your sake\n\nFor your sake, o our children!\n\nCalling you from where you listen \nIn heavenly oceans \nAwaiting birth awaiting love\nAwaiting your come up\n\nYou donÃ¢â‚¬â„¢t know how much we\nLong for you\nTo be among us\nBack where you belong\n\nOh my child!\nPrecious child!\nStay forever while you leave\nStay by my side forever \nMy beautyÃ¢â‚¬Â¦\n\nI will watch you grow\nOut of what I was\nAnd into yourself\n\nAnd only then will I know\nMy time has come\nTo let go.\n\nMy perfume purpose \nHaving filled this earth \nMy scent stamped and \nMy descendants ready, \n\nAble \nto \nRun.",
      "location": "",
      "note": "February 2022. Plane.",
      "categories": [
        "prayer",
        "love",
        "moving"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759820692937,
      "title": "Remembering Carmel",
      "author": "Yusuf Misdaq",
      "content": "Can glass be blown backwards \n      Can solid go back to liquid?\n\nWe keep fantasizing about it\nIn films and in\nShowers as we close our eyes\nAnd in sexuality as we liquify\n\nWe walk timidly towards the ocean \n.ItÃ¢â‚¬â„¢s cold, and that scares us.\nBut we still go there\nAnd we still want to be in it\n\nThe liquid crystal embalming us\nThe water now warm \nA rhythm emerging in our minds \nWe swaying and our arms waving \nDizzying off as some\nLovely slimey thing\nTickles our ankles and small toes\n\nWhere have we gone?\nWhat is this familiar place?\nWhere is my mother if \nThis is origin?\n\nOr does this go back further?\nIt might because \nI can see stars up in this pale blue sky.\n\nAnd I see globes that were planets\nAnd beyond them \nBeyond all\nKnown science\nA slanted door\nTo another realm \n\nThe door is the size of all the universes I just saw \nAnd the realm behind it is so limitless that \nConcepts like size are gone\n\nI open my eyes \nwaist deep in this \nclear blue\nangelness\n\nAs I re-emerge onto the beach \nThe people look at me strangely \nEven though I walk one pace at a time\nWith my limbs I have.\n\nThe beach people have tinny instruments that emit sound waves\nPoor quality transmissions on limited frequencies of \nSound with no width in \nAny sense.\n\nCrimes against humanity look like this\nA sleepy forgetfulness\n\nAnd as I notice the curve of her summer dress\nI smile remembering \nI am rejoining this \nBeautiful mess.",
      "location": "August 2022. Santa Barbara, California.",
      "note": "",
      "categories": [
        "moving",
        "water"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759820731850,
      "title": "Untitled",
      "author": "Yusuf Misdaq",
      "content": "Linear Marouf \nMerciful lines scar the sky \nSay a sangeen fare thee well \nHolding out one hand that waves\nEmotion unspoken and if it be received\nAs a hard token, so be it. \nEverything in its time falls\nPassions rise and inevitable\nLoves eyes and its back of minds \nWhere the boys go running\nAnd the girls hiding\nA dark void to be \nAlone \nand feel.",
      "location": "December 29th, 2021. Washington D.C.",
      "note": "",
      "categories": [
        "sad",
        "black"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759820819689,
      "title": "Goodbye",
      "author": "Yusuf Misdaq",
      "content": "Goodbye my heart\n\nRadiant beauty is yours\nIÃ¢â‚¬â„¢ve seen it and touched it \nIÃ¢â‚¬â„¢ve been inside you\nYou wept and couldnÃ¢â‚¬â„¢t speak\n\nBut you gush open and your\nBody \nWaters your heart. \n\nEvery secret in you and\nEvery formulation within the grasp of your fine mind\n\nBut \n         the dancing and the \n                                                 stillness: \n   Less trodden\n   Less traversed \n   Less tickled.",
      "location": "December 29th, 2021. Washington D.C.",
      "note": "",
      "categories": [
        "love",
        "sad",
        "body"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759820890571,
      "title": "Desires",
      "author": "Yusuf Misdaq",
      "content": "Parody becomes reality  \nThe absurd blends imperceptibly into our daily dose  \nBefore we know it we are nodding in agreement  \nBuying everything, seriously \nLike a German listening intently to a sarcastic joke they donÃ¢â‚¬â„¢t get.    \n\nWe are capable of sinking like a stone to the bottom of a filthy pond  \nSo much can be added to our weight\nSo quickly, new desires can become ours  \nAnd we long for it, and it acts us out \n\nWe move in ways we never would  \nMiming out the persona of someone we donÃ¢â‚¬â„¢t recognize  \nPraying for something we never thought we wanted \n\nStrangers to ourselves  \nNo hearts within us  \nBut awash with these new desires \nAll that remains are the desires in us  \n\nClicking us into movement as our limbs \nJerk into action and sprawl us across the cities.",
      "location": "July 6th, 2022. My Van, California.",
      "note": "",
      "categories": [
        "body",
        "society",
        "grr"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759821032185,
      "title": "A Poem for Electronica Musicians",
      "author": "Yusuf Misdaq",
      "content": "Sometimes I wonder if \nI sold my soul to the arpeggiator   \n\nSometimes I wonder if  \nI let the wrong one in  \n\nSometimes I wonder if  \nI've been surfing a wave that isn't my own  \n\nSometimes I wonder if  \nI could drop all the coins and start anew  \n\nFirey teardrops velveting down my mountainous robes\nInto the black chasm that takes three days to reach \nThe earth of earth \nWherein lies a bubbling spring",
      "location": "April 19th, 2019. Maryland.",
      "note": "",
      "categories": [
        "music"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759821079505,
      "title": "Untitled",
      "author": "Yusuf Misdaq",
      "content": "far reaching star unfolds  \nthere has been sand that  \nfeels for me rising  \nfeels for me  \nsun in my hand   \n\nin my mouth  \nthere is  \ncrystal spuck  \n\nreal fabrication  \nspitting out mist  \nemitting rarified  \nluck\n\nlanding upon your  \nshoulders ive come  \nto hold you from  \nbehind and place \nhands upon your \nlower back that  \nenergize and ironize  \nglueing you \ncontagious   \n\ni hold your breath \nin my palms i will  \nheal you               \n               r skin  \nthrough skin  \ni encounter \nessence  \n\nyour ink \nbefore it made words \n\nyour dark ink  \nthat i saw and know \nbefore it filled your  \nreceptacle and  \nmade float \n\nyour vessels \ni knew your  \ninky origins  \n\nand everything that you do  \nwould be as natural to me as  \nwater on my hands and  \ninterlocking my fingers and \nholding you from behind  \nus locked in to one.",
      "location": "April 19th, 2019. Maryland.",
      "note": "",
      "categories": [
        "love",
        "water",
        "body"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759821337420,
      "title": "Prep Coffee",
      "author": "Yusuf Misdaq",
      "content": "Chimes echo out of the starlight  \nA bird chases a squirrel down a tree \nHappenings in the orbital sky \nTwinkling stars and the look in your eye    \n\nTouch me \nDonÃ¢â‚¬â„¢t touch me \nReach far in  \n\nLove me \nDonÃ¢â‚¬â„¢t come, just   \n   Stay                     \n                   as you are    \n\nA far river \nIn the eyes sunken distance \nThe green, dreaming hills \nMelting without insistence  \n\nPie on the wind\nFood from a lover prepared\nKindness pellets\nLove, touch me by the air.  \n\n*\n\nThey turn the volume down self-consciously when Nirvana comes on\nThey think itÃ¢â‚¬â„¢s too rough for this sun\nBut really\nThe friction makes the moonlight smoother",
      "location": "May 7th, 2022. New Jersey.",
      "note": "For Wazo",
      "categories": [
        "light",
        "music",
        "star"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759821501927,
      "title": "Sleepy Poem",
      "author": "Yusuf Misdaq",
      "content": "My temple is certified and affluent when denied and dented, \nIt fills with smoke which also clears, and settled suns which also rise. \nMy tears are drowning fears which slowly vapour clear on up,\nCloud is me and you and all our pain that cries to feel relieved, \nRain on earth is vapour, we are cycles, we are circles. \nAll the time forgetting, 'til we turn and must remember.",
      "location": "May 13th, 2006. Brighton.",
      "note": "",
      "categories": [
        "sad",
        "water"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759821701322,
      "title": "Twinners",
      "author": "Yusuf Misdaq",
      "content": "Adjoining rooms\n   You visit me when mine is flooded\n      richly with sun\n   IÃ¢â‚¬â„¢ll come to yours, too, \n      At the mirrored moment of our day\nCorrespondingly \n   WeÃ¢â‚¬â„¢ll talk water particles \n      into the sand particles \n         and our desert will \n           balance and lose\n              its sting",
      "location": "Jan 25th, 2024. Downtown Los Angeles.",
      "note": "",
      "categories": [
        "light",
        "time",
        "water"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759821791823,
      "title": "Untitled",
      "author": "Yusuf Misdaq",
      "content": "Chiming is everything \n\nThatÃ¢â‚¬â„¢s the motto I live by \n\nI sit in a resonant room \n of hammered metal pans\n  gongs and tuning forks \n   but I make no move\n     and in silence\n      await you in \n       anticipation of \n        the noise you will \n         come with and \n          how each chime\n           will dictate the \n            next moment",
      "location": "Jan 25th, 2024. Downtown Los Angeles.",
      "note": "",
      "categories": [
        "music"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759821936322,
      "title": "Airways",
      "author": "Yusuf Misdaq",
      "content": "A trigonal\n                 muck \nFor six paces\n       Keep your nose out of \n           my airspaces\n                  \nMy airways arenÃ¢â‚¬â„¢t yet clear\n   ItÃ¢â‚¬â„¢s obvious and apparent \n    as blockages always are\n\nThe state of the world (burning)\n    ironically requires long \n         cooling breaths \n           which in \n              turn\n        necessitate \n       clear airways                     \n\nHaving experienced the serenity of regular meditation, \nI have become one of those lucky people who can say things like \nÃ¢â‚¬Ëœif only everyone (or enough people) could blow \ncool calming air onto the world \nthings would change.'",
      "location": "March 10th, 2024. Rosslyn, Virginia",
      "note": "",
      "categories": [
        "moving",
        "society"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759822116799,
      "title": "Untitled",
      "author": "Yusuf Misdaq",
      "content": "Salient touching stones\n   mark up with clinks \nthe noise re-arrangements \nand uncommon \ndemanifestings \nall signed off \nunicorn signatures\navid signatories \nfiery tributaries\nmodern ritual flushers",
      "location": "March 13th 2024, Dubai Terminal 2, on Runway.",
      "note": "",
      "categories": [
        "art"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759822384775,
      "title": "No Title",
      "author": "Yusuf Misdaq",
      "content": "No one asked and \n   therefore never knew \n     of the goldfish that \n        swim inside me\n      they tickle \n        and keep my torso \n          on its toes \n\nThe manifesting gatherer \n  that lives in the center \n   of the berry forest\n  wages all their fortunes \n   on the snow coming \n     out gold this   \n      spring season \n         but the ax \n  wielding barbarian \nscientists have already \nset in motion the \nburning/harvesting schedule \nfor the next 71 years\nwhich is when they calculate\nthat all of the resources will \nfinally be excavated and evaporated \nÃ¢â‚¬Å“then, and only then,Ã¢â‚¬ said Chuck\nÃ¢â‚¬Å“Will we exit with dignity.Ã¢â‚¬",
      "location": "March 13th 2024, Dubai Terminal 2, on Runway.",
      "note": "",
      "categories": [
        "lol",
        "society"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759822472139,
      "title": "Untitled",
      "author": "Yusuf Misdaq",
      "content": "Mansion\n               sell my home\n\nI want to live with you\n my zip code will change to you\n  and six of my seven names\n   will become your names\n\n     the straightest legendary lovers\n      must become women\n       it has to happen.",
      "location": "March 13th 2024, Dubai Terminal 2, on Runway.",
      "note": "",
      "categories": [
        "love"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759822573323,
      "title": "In Every Injury",
      "author": "Yusuf Misdaq",
      "content": "I keep falling and in \n   every red graze \n                            on my knee\n                      I see your\n                    loving (of) me.",
      "location": "March 13th 2024, Dubai Terminal 2, on Runway.",
      "note": "",
      "categories": [
        "body",
        "love"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759822701613,
      "title": "Days",
      "author": "Yusuf Misdaq",
      "content": "I have to walk out to the gallows \nEach time I leave my home\n\n  thatÃ¢â‚¬â„¢s what life begins to feel like\n\nBut IÃ¢â‚¬â„¢m walking with freed will \nKnowing the torture is really \n  nurture.",
      "location": "March 13th 2024, Dubai Terminal 2, on Runway.",
      "note": "",
      "categories": [
        "black",
        "moving",
        "society"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759822957180,
      "title": "The Mountaineer Ã¢â‚¬" D E F R O C K E D",
      "author": "Yusuf Misdaq",
      "content": "I climb to the top of the ladder\n muezzin move\nall to declare to the world\n that IÃ¢â‚¬â„¢m a man \n   that, I promise, IÃ¢â‚¬â„¢m a man. \n\nI can strike !\n make fire !\npound the mountain and \nstand on top. \n\nI canÃ¢â‚¬â„¢t fly \nMy thuddy vesture keeps \nheavy clods entrenched \n                                      in \n    soil and sod. \n\nIÃ¢â‚¬â„¢m sad and small \n  Behind a nightingales call\nMy all, summarized\n  and standing tall is\n  aught but a speck\n  of filigree dust\n\nMust my shadow and \n    Ancestus reduce me \n      punishingly down\n   to the lower-ranked\n      classes?\n\nIf I donÃ¢â‚¬â„¢t listen and\n  take heed I surely \n    will achieve magnificence\n      but only in the manner\n        of my comeuppance \n    wherein a great white \n        thunder strike shall \n          seek my skull end \n                             and \n        fling me off\nthis goliath mound. \n\nOr, if the wise back-tredder\n   is found within my \n      puffed-up foolery \n   and I tender my self \n     and step down \n     returning to my \n    simple village of chums\n     where I was only \n      (but always) meÃ¢â‚¬Â¦ \n\n\n\nA carrot in the tree\n some later month or three\n    just me alone \n knees up by my ears\nlike I was twenty (and\n   not forty) three\nmunching contentedly \n   as the orange sun \n     breaks free. \n\nÃ¢â‚¬Å“My family, I have\n   they know me!Ã¢â‚¬  \nA satisfying, brave \n    crunch of nothing \n to accompany my \ngreat economy epiphany",
      "location": "March 13th 2024, Dubai Terminal 2, on Runway.",
      "note": "",
      "categories": [
        "grr",
        "light",
        "lol"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759823248773,
      "title": "\"Shukran\"",
      "author": "Yusuf Misdaq",
      "content": "\"Shukran,\"\nspoken softly \n\nthe warm chain \nthat binds action\nto ethic",
      "location": "March 13th, 2024, Plane",
      "note": "",
      "categories": [
        "society"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759823403674,
      "title": "My Invisible Career circa. 2024",
      "author": "Yusuf Misdaq",
      "content": "An infinite mind \nthat keeps on \ncreating new vistas \nand variations \n\nthey never knew me \nand now they call it \"A.I.\"\n\nI laugh, because\nnothing insults me",
      "location": "March 13th, 2024, Plane",
      "note": "",
      "categories": [
        "lol"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759823458495,
      "title": "The Future",
      "author": "Yusuf Misdaq",
      "content": "wherever I have left \nto go \nawaits \n           me\n    excitedly",
      "location": "March 13th, 2024, Plane",
      "note": "",
      "categories": [
        "moving",
        "time"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759823895495,
      "title": "Fasting amongst average Muslims",
      "author": "Yusuf Misdaq",
      "content": "'Don't use your mind,'\nI want to tell the boy who is unaware\nHe is silhouetted by a sun \nin the window behind him\nAs he tells me energetically that \nit's too late for me to eat the food\nthat I've just been given. \n'Use your eyes!'\n\nThese salafis are taking\nthe most beautiful aspect of Islam\n - its nearness to nature - \nand are actively anesthetizing it\nuntil eventually \nall that's left will be \nlux scents\nmarble floors and \na golden statue \nof Cristiano Ronaldo.",
      "location": "March 13th, 2024, Plane",
      "note": "",
      "categories": [
        "grr",
        "lol",
        "society",
        "time"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759824421004,
      "title": "Untitled",
      "author": "Yusuf Misdaq",
      "content": "It's always night in space\nSteps in floating zero \nYour astro hands up like\na mime or a helpless blind \nperson \n\nYour eyes may as well be closed\nYour lips smacking together feebly \nYou are a dot \n                          passing through the great\nInfinite.",
      "location": "March 18th, 2024. Karte Parwan, Kabul.",
      "note": "",
      "categories": [
        "afg",
        "black"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759824713383,
      "title": "Lillianne aka Lily",
      "author": "Yusuf Misdaq",
      "content": "Lillanne Pharaohdust\n Lillyanne Thomlinson \n  Lillyanne of the pond and lake\n    Lillyanne of the boudoir \n      (before it's too late)\n    She applies blusher to her cheeks\n       and stick to her cake hole\n    She's been on fire since the day she was born\n       Lillyanne desert \n          Lillyanne valley \n              Lilzy jokes by the poolside\n                 Playing cards with the cool guys\n                    Flowin jus like a moon tide\n                      Glowin just like a moon rise \n\n              Cool Lily \n                                   Water Lily \n                  Moistily",
      "location": "March 25th, 2024. Dubai Terminal 3.",
      "note": "",
      "categories": [
        "lol"
      ],
      "bookSource": null,
      "comments": []
    },
    {
      "id": 1759825287123,
      "title": "Pre Nuptual Eulogy",
      "author": "Yusuf Misdaq",
      "content": "1\nOh God\nCrack open the dark \nPrism in the\n dark chasm in\n  the silent hole\n    in me. \n\nIf You scan Your ray \n    of light on \n  that hidden \n    shadow jewel \n  You will show me\n    and the world\n  what it means\n     'being alive.'\n\nI have never ever prayed \n   for electrocution \n   or destruction in my life. \n\nBut if it be at Your loving hands, \n   \"take me!\" \n\nI give unto \n   I leave me\n       to You. \n\nFlame away me\n   My hands raised\n      Like a flag up \n         in flames. \n\nI wave goodbye\n  Left to right\n     sway away \n        into the light. \n\n2\nMaybe other things \n will remain out\n        lasting me\n     I will accept \n      coming out early \n\nAsh. Toblerone. Booze. \n      I never felt right\n      sharing the stage\n    with so many games. \n\nWhen I was young I wanted \n   to cover everything \n      in flames. \n\nNow that I'm serious\n  I ask only You God\n    To flood my bloody \n        body with Your\n        magic electrons\n            and let me \n         join the ranks\n         of the natural\n                ones.",
      "location": "March 25th, 2024. Plane Returning from Afghanistan.",
      "note": "",
      "categories": [
        "afg",
        "prayer"
      ],
      "bookSource": null,
      "comments": []
    }
  ],
  "categories": [
    "afg",
    "art",
    "black",
    "body",
    "grr",
    "light",
    "lol",
    "love",
    "moving",
    "music",
    "prayer",
    "sad",
    "society",
    "star",
    "time",
    "water"
  ]
};

        var state = {
            view: 'home',
            category: null,
            authenticated: false,
            editingId: null,
            dropdowns: {},
            currentPoemId: null
        };

        function init() {
            document.getElementById('year').textContent = new Date().getFullYear();
            document.getElementById('book-toggle').addEventListener('change', function(e) {
                document.getElementById('book-fields').classList.toggle('hidden', !e.target.checked);
            });
            loadData();
            render();
        }

        function loadData() {
            var saved = localStorage.getItem('poetry-eternal');
            if (saved) {
                data = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('poetry-eternal', JSON.stringify(data));
        }

        function render() {
            if (state.view === 'admin' && !state.authenticated) {
                showLogin();
            } else if (state.view === 'admin') {
                showAdmin();
            } else {
                showPublic();
            }
        }

        function showLogin() {
            document.getElementById('public-view').classList.add('hidden');
            document.getElementById('admin-view').classList.add('hidden');
            document.getElementById('login-view').classList.remove('hidden');
        }

        function showAdmin() {
            document.getElementById('public-view').classList.add('hidden');
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('admin-view').classList.remove('hidden');
            renderAdmin();
        }

        function showPublic() {
            document.getElementById('login-view').classList.add('hidden');
            document.getElementById('admin-view').classList.add('hidden');
            document.getElementById('public-view').classList.remove('hidden');
            renderCategories();
            renderPoem();
        }

        function renderCategories() {
            var categories = shuffleArray(data.categories.slice());
            var html = '';
            for (var i = 0; i < categories.length; i++) {
                var cat = categories[i];
                var active = state.category === cat ? ' active' : '';
                html += '<span class="category-link' + active + '" onclick="selectCategory(\'' + cat + '\')">#' + cat + '</span>';
            }
            document.getElementById('categories-container').innerHTML = html;
        }

        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
            return array;
        }

        function renderPoem() {
            var poem = getRandomPoem();
            if (!poem) {
                document.getElementById('poem-display').innerHTML = '<p>No poems available. Add some in the admin panel!</p>';
                return;
            }

            state.currentPoemId = poem.id;

            var html = '<article>';
            html += '<h2 class="poem-title">' + escapeHtml(poem.title) + '</h2>';
            html += '<p class="poem-author">By <a href="https://en.wikipedia.org/wiki/Y._Misdaq" target="_blank">' + escapeHtml(poem.author).toUpperCase() + '</a></p>';
            html += '<div class="poem-content">' + escapeHtml(poem.content) + '</div>';
            if (poem.location) html += '<p class="poem-location">' + escapeHtml(poem.location) + '</p>';
            if (poem.note) html += '<p class="poem-note">' + escapeHtml(poem.note) + '</p>';
            html += '<button onclick="getNewPoem()" class="new-poem-button">Get New Poem</button>';
            html += '</article>';

            html += '<div class="interactive-sections">';
            
            if (poem.comments && poem.comments.length > 0) {
                html += '<div class="dropdown-section">';
                html += '<button class="dropdown-trigger" onclick="toggleDropdown(\'reader-comments\')">ðŸ’­ What other readers felt</button>';
                html += '<div class="dropdown-content hidden" data-dropdown="reader-comments">';
                for (var i = 0; i < poem.comments.length; i++) {
                    var comment = poem.comments[i];
                    html += '<div style="border-bottom: 1px solid #eee; padding: 1rem 0; margin-bottom: 1rem;">';
                    if (comment.name) {
                        html += '<p style="font-weight: 500; margin-bottom: 0.5rem;">' + escapeHtml(comment.name) + '</p>';
                    }
                    html += '<p style="font-size: 0.95rem; line-height: 1.6;">' + escapeHtml(comment.text) + '</p>';
                    html += '<p style="font-size: 0.75rem; color: #999; margin-top: 0.5rem;">' + comment.date + '</p>';
                    html += '</div>';
                }
                html += '</div></div>';
            }
            
            html += '<div class="dropdown-section">';
            html += '<button class="dropdown-trigger" onclick="toggleDropdown(\'share\')">ðŸ“¤ Share this poem</button>';
            html += '<div class="dropdown-content hidden" data-dropdown="share">';
            html += '<button onclick="copyShareLink()">ðŸ“‹ Copy link</button>';
            html += '<a href="https://twitter.com/intent/tweet?text=' + encodeURIComponent(poem.title + ' by ' + poem.author) + '" target="_blank">Share on Twitter</a>';
            html += '<a href="https://www.facebook.com/sharer/sharer.php" target="_blank">Share on Facebook</a>';
            html += '<a href="https://wa.me/?text=' + encodeURIComponent(poem.title) + '" target="_blank">Share on WhatsApp</a>';
            html += '<a href="sms:?body=' + encodeURIComponent(poem.title) + '">Share via SMS</a>';
            html += '</div></div>';

            if (poem.bookSource) {
                html += '<div class="dropdown-section">';
                html += '<button class="dropdown-trigger" onclick="toggleDropdown(\'book\')">ðŸ“š Buy this poem</button>';
                html += '<div class="dropdown-content hidden" data-dropdown="book">';
                html += '<div class="book-display">';
                if (poem.bookSource.coverImage) {
                    html += '<img src="' + escapeHtml(poem.bookSource.coverImage) + '" class="book-cover" alt="Book cover" onerror="this.style.display=\'none\'">';
                }
                html += '<div><h3>' + escapeHtml(poem.bookSource.title) + '</h3>';
                html += '<p>' + escapeHtml(poem.author) + '</p>';
                html += '<p>' + escapeHtml(poem.bookSource.year) + '</p>';
                html += '<a href="' + escapeHtml(poem.bookSource.amazonUrl) + '" target="_blank" class="amazon-link">Available on Amazon</a>';
                html += '</div></div></div></div>';
            }

            html += '<div class="dropdown-section">';
            html += '<button class="dropdown-trigger" onclick="toggleDropdown(\'comments\')">ðŸ’¬ Comment on this poem</button>';
            html += '<div class="dropdown-content hidden" data-dropdown="comments">';
            html += '<div id="comment-form-' + poem.id + '">';
            html += '<input type="text" id="comment-name-' + poem.id + '" placeholder="Your name (optional)" style="width: 100%; padding: 0.5rem; margin-bottom: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-family: Georgia, serif;">';
            html += '<input type="email" id="comment-email-' + poem.id + '" placeholder="Your email (optional)" style="width: 100%; padding: 0.5rem; margin-bottom: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-family: Georgia, serif;">';
            html += '<textarea id="comment-text-' + poem.id + '" placeholder="Share your thoughts..." style="width: 100%; padding: 0.5rem; margin-bottom: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-family: Georgia, serif; min-height: 6rem; resize: vertical;"></textarea>';
            html += '<button onclick="submitComment(' + poem.id + ')" style="padding: 0.75rem 1.5rem; background: #000; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-family: Georgia, serif;">Post Comment</button>';
            html += '</div></div></div>';

            html += '</div>';

            document.getElementById('poem-display').innerHTML = html;
        }

        function getRandomPoem() {
            var poems = data.poems;
            if (state.category) {
                poems = poems.filter(function(p) {
                    return p.categories.indexOf(state.category) !== -1;
                });
            }
            if (poems.length === 0) return null;
            if (poems.length === 1) return poems[0];
            
            var availablePoems = poems.filter(function(p) {
                return p.id !== state.currentPoemId;
            });
            
            if (availablePoems.length === 0) {
                availablePoems = poems;
            }
            
            return availablePoems[Math.floor(Math.random() * availablePoems.length)];
        }

        function selectCategory(cat) {
            state.category = state.category === cat ? null : cat;
            state.dropdowns = {};
            renderCategories();
            renderPoem();
        }

        function toggleDropdown(type) {
            var wasOpen = state.dropdowns[type];
            state.dropdowns = {};
            state.dropdowns[type] = !wasOpen;
            
            var allContents = document.querySelectorAll('.dropdown-content');
            for (var i = 0; i < allContents.length; i++) {
                allContents[i].classList.add('hidden');
            }
            
            var targetContent = document.querySelector('[data-dropdown="' + type + '"]');
            if (targetContent && state.dropdowns[type]) {
                targetContent.classList.remove('hidden');
            }
        }

        function getNewPoem() {
            state.dropdowns = {};
            renderPoem();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function copyShareLink() {
            alert('Link copied to clipboard!');
        }

        function submitComment(poemId) {
            var name = document.getElementById('comment-name-' + poemId).value.trim();
            var email = document.getElementById('comment-email-' + poemId).value.trim();
            var text = document.getElementById('comment-text-' + poemId).value.trim();

            if (!text) {
                alert('Please write a comment before posting.');
                return;
            }

            var comment = {
                name: name || 'Anonymous',
                email: email,
                text: text,
                date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
            };

            for (var i = 0; i < data.poems.length; i++) {
                if (data.poems[i].id === poemId) {
                    if (!data.poems[i].comments) {
                        data.poems[i].comments = [];
                    }
                    data.poems[i].comments.push(comment);
                    break;
                }
            }

            saveData();
            alert('Thank you for sharing your thoughts!');
            
            document.getElementById('comment-name-' + poemId).value = '';
            document.getElementById('comment-email-' + poemId).value = '';
            document.getElementById('comment-text-' + poemId).value = '';
            
            renderPoem();
        }

        function goHome() {
            state.view = 'home';
            state.category = null;
            render();
        }

        function goToAdmin() {
            state.view = 'admin';
            render();
        }

        function login() {
            var pw = document.getElementById('password-input').value;
            if (pw === 'totti44') {
                state.authenticated = true;
                render();
                document.getElementById('password-input').value = '';
            } else {
                alert('Incorrect password');
            }
        }

        function logout() {
            state.authenticated = false;
            state.view = 'home';
            render();
        }

        function renderAdmin() {
            renderCategoryCheckboxes();
            renderCategoryChips();
            renderPoemsList();
            renderCommentsList();
        }

        function renderCategoryCheckboxes() {
            var html = '';
            for (var i = 0; i < data.categories.length; i++) {
                html += '<label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox" value="' + data.categories[i] + '" class="cat-cb" style="width: auto;"> ' + data.categories[i] + '</label>';
            }
            document.getElementById('category-checkboxes').innerHTML = html;
        }

        function renderCategoryChips() {
            var html = '';
            for (var i = 0; i < data.categories.length; i++) {
                var cat = data.categories[i];
                html += '<span class="category-chip">' + cat + ' <button onclick="deleteCategory(\'' + cat + '\')">âœ•</button></span>';
            }
            document.getElementById('category-chips').innerHTML = html;
        }

        function renderPoemsList() {
            document.getElementById('poem-count').textContent = data.poems.length;
            var html = '';
            for (var i = 0; i < data.poems.length; i++) {
                var p = data.poems[i];
                html += '<div class="poem-list-item">';
                html += '<div><h3 style="font-weight: 500; margin-bottom: 0.25rem;">' + escapeHtml(p.title) + '</h3>';
                html += '<p style="font-size: 0.9rem; color: #666;">' + p.categories.join(', ') + '</p></div>';
                html += '<div><button onclick="editPoem(' + p.id + ')" class="button button-warning">Edit</button>';
                html += '<button onclick="deletePoem(' + p.id + ')" class="button button-danger">Delete</button></div>';
                html += '</div>';
            }
            document.getElementById('poems-list').innerHTML = html || '<p>No poems yet. Add your first poem above!</p>';
        }

        function renderCommentsList() {
            var html = '';
            var totalComments = 0;
            
            for (var i = 0; i < data.poems.length; i++) {
                var poem = data.poems[i];
                if (poem.comments && poem.comments.length > 0) {
                    html += '<div style="border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; background: #fafafa;">';
                    html += '<h3 style="font-size: 1.1rem; margin-bottom: 1rem; font-weight: 500;">' + escapeHtml(poem.title) + '</h3>';
                    
                    for (var j = 0; j < poem.comments.length; j++) {
                        var comment = poem.comments[j];
                        totalComments++;
                        html += '<div style="background: white; border: 1px solid #eee; border-radius: 4px; padding: 1rem; margin-bottom: 0.75rem;">';
                        html += '<div style="display: flex; justify-content: space-between; align-items: start;">';
                        html += '<div style="flex: 1;">';
                        html += '<p style="font-weight: 500; margin-bottom: 0.25rem;">' + escapeHtml(comment.name) + '</p>';
                        if (comment.email) {
                            html += '<p style="font-size: 0.85rem; color: #666; margin-bottom: 0.5rem;">' + escapeHtml(comment.email) + '</p>';
                        }
                        html += '<p style="font-size: 0.95rem; line-height: 1.5; margin-bottom: 0.5rem;">' + escapeHtml(comment.text) + '</p>';
                        html += '<p style="font-size: 0.75rem; color: #999;">' + comment.date + '</p>';
                        html += '</div>';
                        html += '<button onclick="deleteComment(' + poem.id + ', ' + j + ')" class="button button-danger" style="margin-left: 1rem;">Delete</button>';
                        html += '</div></div>';
                    }
                    html += '</div>';
                }
            }
            
            if (totalComments === 0) {
                html = '<p style="color: #666;">No comments yet. Comments will appear here once readers start sharing their thoughts.</p>';
            } else {
                html = '<p style="margin-bottom: 1rem; font-weight: 500;">Total comments: ' + totalComments + '</p>' + html;
            }
            
            document.getElementById('comments-list').innerHTML = html;
        }

        function deleteComment(poemId, commentIndex) {
            if (confirm('Are you sure you want to delete this comment?')) {
                for (var i = 0; i < data.poems.length; i++) {
                    if (data.poems[i].id === poemId) {
                        data.poems[i].comments.splice(commentIndex, 1);
                        break;
                    }
                }
                saveData();
                renderAdmin();
            }
        }

        function savePoem() {
            var title = document.getElementById('title-input').value.trim();
            var author = document.getElementById('author-input').value.trim();
            var content = document.getElementById('content-input').value.trim();
            var location = document.getElementById('location-input').value.trim();
            var note = document.getElementById('note-input').value.trim();

            if (!title || !content) {
                alert('Please fill in at least the title and content');
                return;
            }

            var categories = [];
            var cbs = document.querySelectorAll('.cat-cb:checked');
            for (var i = 0; i < cbs.length; i++) {
                categories.push(cbs[i].value);
            }

            var bookSource = null;
            if (document.getElementById('book-toggle').checked) {
                bookSource = {
                    title: document.getElementById('book-title').value.trim(),
                    amazonUrl: document.getElementById('book-amazon').value.trim(),
                    coverImage: document.getElementById('book-cover').value.trim(),
                    year: document.getElementById('book-year').value.trim()
                };
            }

            var poem = {
                id: state.editingId || Date.now(),
                title: title,
                author: author,
                content: content,
                location: location,
                note: note,
                categories: categories,
                bookSource: bookSource
            };

            if (state.editingId) {
                for (var i = 0; i < data.poems.length; i++) {
                    if (data.poems[i].id === state.editingId) {
                        data.poems[i] = poem;
                        break;
                    }
                }
            } else {
                data.poems.push(poem);
            }

            saveData();
            resetForm();
            renderAdmin();
            alert('Poem saved successfully!');
        }

        function editPoem(id) {
            var poem = null;
            for (var i = 0; i < data.poems.length; i++) {
                if (data.poems[i].id === id) {
                    poem = data.poems[i];
                    break;
                }
            }
            if (!poem) return;

            state.editingId = id;
            document.getElementById('title-input').value = poem.title;
            document.getElementById('author-input').value = poem.author;
            document.getElementById('content-input').value = poem.content;
            document.getElementById('location-input').value = poem.location || '';
            document.getElementById('note-input').value = poem.note || '';

            var cbs = document.querySelectorAll('.cat-cb');
            for (var i = 0; i < cbs.length; i++) {
                cbs[i].checked = poem.categories.indexOf(cbs[i].value) !== -1;
            }

            if (poem.bookSource) {
                document.getElementById('book-toggle').checked = true;
                document.getElementById('book-fields').classList.remove('hidden');
                document.getElementById('book-title').value = poem.bookSource.title || '';
                document.getElementById('book-amazon').value = poem.bookSource.amazonUrl || '';
                document.getElementById('book-cover').value = poem.bookSource.coverImage || '';
                document.getElementById('book-year').value = poem.bookSource.year || '';
            }

            document.getElementById('form-title').textContent = 'Edit Poem';
            document.getElementById('cancel-btn').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function deletePoem(id) {
            if (confirm('Are you sure you want to delete this poem?')) {
                data.poems = data.poems.filter(function(p) { return p.id !== id; });
                saveData();
                renderAdmin();
            }
        }

        function cancelEdit() {
            resetForm();
        }

        function resetForm() {
            state.editingId = null;
            document.getElementById('title-input').value = '';
            document.getElementById('author-input').value = 'Yusuf Misdaq';
            document.getElementById('content-input').value = '';
            document.getElementById('location-input').value = '';
            document.getElementById('note-input').value = '';
            document.getElementById('book-toggle').checked = false;
            document.getElementById('book-fields').classList.add('hidden');
            document.getElementById('book-title').value = '';
            document.getElementById('book-amazon').value = '';
            document.getElementById('book-cover').value = '';
            document.getElementById('book-year').value = '';
            document.getElementById('form-title').textContent = 'Add New Poem';
            document.getElementById('cancel-btn').classList.add('hidden');

            var cbs = document.querySelectorAll('.cat-cb');
            for (var i = 0; i < cbs.length; i++) {
                cbs[i].checked = false;
            }
        }

        function addCategory() {
            var newCat = document.getElementById('new-category').value.trim().toLowerCase();
            if (newCat && data.categories.indexOf(newCat) === -1) {
                data.categories.push(newCat);
                data.categories.sort();
                saveData();
                renderAdmin();
                document.getElementById('new-category').value = '';
            }
        }

        function deleteCategory(cat) {
            if (confirm('Delete category "' + cat + '"? This won\'t delete poems, just the category.')) {
                data.categories = data.categories.filter(function(c) { return c !== cat; });
                saveData();
                renderAdmin();
            }
        }

        function exportData() {
            try {
                var dataStr = JSON.stringify(data, null, 2);
                var dataBlob = new Blob([dataStr], { type: 'application/json' });
                var url = URL.createObjectURL(dataBlob);
                var link = document.createElement('a');
                link.href = url;
                var dateStr = new Date().toISOString().split('T')[0];
                link.download = 'poetry-eternal-backup-' + dateStr + '.json';
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                setTimeout(function() {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                alert('Data exported successfully! Keep this file safe as a backup.');
            } catch (err) {
                alert('Export error: ' + err.message);
                console.log('Full data for manual export:', JSON.stringify(data, null, 2));
            }
        }

        function importData(event) {
            var file = event.target.files[0];
            if (!file) return;

            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var importedData = JSON.parse(e.target.result);
                    if (importedData.poems && importedData.categories) {
                        if (confirm('This will replace all current data. Are you sure?')) {
                            data = importedData;
                            saveData();
                            renderAdmin();
                            alert('Data imported successfully! You now have ' + data.poems.length + ' poems.');
                        }
                    } else {
                        alert('Invalid data file. Please select a valid Poetry Eternal backup file.');
                    }
                } catch (err) {
                    alert('Error reading file. Please make sure it\'s a valid JSON file.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function escapeHtml(text) {
            var map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        init();
    </script>
</body>
</html>
